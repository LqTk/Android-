package com.you007.weibo.weibo2.map.newgis.bleTooth;

import android.app.Dialog;
import android.bluetooth.BluetoothAdapter;
import android.bluetooth.BluetoothDevice;
import android.bluetooth.BluetoothGatt;
import android.bluetooth.BluetoothGattCallback;
import android.bluetooth.BluetoothGattCharacteristic;
import android.bluetooth.BluetoothGattDescriptor;
import android.bluetooth.BluetoothGattService;
import android.bluetooth.BluetoothManager;
import android.bluetooth.BluetoothProfile;
import android.bluetooth.le.ScanCallback;
import android.bluetooth.le.ScanResult;
import android.content.Context;
import android.os.Build;
import android.os.Bundle;
import android.os.Handler;
import android.os.Looper;
import android.os.Message;
import android.text.TextUtils;
import android.util.Log;
import android.view.View;
import android.widget.AdapterView;
import android.widget.ListView;
import android.widget.ProgressBar;
import android.widget.TextView;
import android.widget.Toast;

import com.amap.api.maps.CoordinateConverter;
import com.tools.and.utils.from.qixin.dialog.ShowBar;
import com.you007.weibo.weibo1.model.app.ApplicationData;
import com.you007.weibo.weibo2.map.newgis.NavigationResultActivityShang;
import com.you007.weibo.weibo2.map.newgis.bleCallBack;
import com.you007.weibo.weibo2.model.utils.ToastUtil;

import java.util.ArrayList;
import java.util.List;
import java.util.Random;
import java.util.UUID;

import static com.mapbox.mapboxsdk.Mapbox.getApplicationContext;

/**
 * Created by Tang on 2017/11/21.
 */

public class BLELocationClient extends ScanCallback implements Runnable{
    String SERVICE_UUID = "0000fee0-0000-1000-8000-00805f9b34fb";
    String CHARACTER_UUID = "0000fee1-0000-1000-8000-00805f9b34fb";
    String MAC = "00:15:83:00:E8:F2";

    private Global global;
    private ListView bleList;
    private ProgressBar ble_pro;
    Context context = null;
    static bleCallBack.bleCall bleCallback;
    static bleCallBack.bleCall NavigationBleCallback;
    static bleCallBack.bleCall HomeBleCallback;
    String[][] dataMsgs = new String[][]{{"商鼎国际",
            "$THSJTCC,1,2,123,500,3.0\n",
            "$THSJTRK,1,A,B,00,30.62202985,104.06617864\n",
            "$THSJTCK,1,A,B,01,30.62049058,104.06516338\n",
            "$THSJTZHK,5,A,B,00,30.621876134,104.06621639,A,B,01,30.62109603,104.06579589,A,B,02,30.62082088,104.06545650,A,B,02,30.62082744,104.06578875,A,B,01.30.62096393,104.06545894\n",
            "$THSJTJZD,10,A,B,01,30.62116471,104.06606996,A,B,01,30.62131109,104.06584434,A,B,01,30.62126856,104.06518311,A,B,01,30.62127576,104.06534399,A,B,01,30.62128097,104.06551717,A,B,01,30.62128494,104.06568976,A,B,01,30.62084034,104.06552741,A,B,01,30.62099014,104.06551842,A,B,01,30.62078052,104.06552667,A,B,01,30.62068370,104.06569799\n"},
            {"武汉东风技术",
            "$THSJTCC,2,0,1,5,3.0\n",
            "$THSJTRK,1,A,B,00, 30.447120, 114.075271\n",
            "$THSJTCK,1,A,B,00, 30.447120, 114.075271\n",
            "$THSJTZHK,2,A,B,00,30.446495,114.076925,A,B,01,30.446597,114.077255\n",
            "$THSJTJZD,9,A,B,01,30.446513,114.077091,A,B,01,30.446636,114.077248,A,B,01,30.446677,114.076855,A,B,01,30.446840,114.076830,A,B,01,30.446993,114.076796,A,B,01,30.447142,114.076770,A,B,01,30.447036,114.075960,A,B,01,30.446887,114.075990,A,B,01,30.446725,114.076025\n"}
};

    String str="$THSJDRMSG,104409.000,30.540423393,N,104.087052584,E,468.86,0.00,85.86,2,19,0.6,405.5,1,1,1,F,F01,00*4C\n" +
            "$THSJDRMSG,104450.000,30.540423393,N,104.087052584,E,468.86,0.00,85.17,2,20,0.6,405.3,1,1,1,F,F01,00*44\n" +
            "$THSJDRMSG,104451.000,30.540423632,N,104.087054729,E,468.87,0.21,84.48,2,20,0.6,405.3,1,1,1,F,F01,00*41\n" +
            "$THSJDRMSG,104452.000,30.540425479,N,104.087076783,E,468.62,2.12,84.43,2,20,0.6,405.2,1,1,1,F,F01,00*4A\n" +
            "$THSJDRMSG,104453.000,30.540427983,N,104.087104678,E,468.61,2.69,83.30,2,20,0.7,405.2,1,1,1,F,F01,00*4D\n" +
            "$THSJDRMSG,104454.000,30.540431499,N,104.087134004,E,468.72,2.83,80.70,2,21,0.7,405.3,1,1,1,F,F01,00*44\n" +
            "$THSJDRMSG,104455.000,30.540435970,N,104.087161541,E,468.88,2.69,78.31,2,19,0.7,405.3,1,1,1,F,F01,00*47\n" +
            "$THSJDRMSG,104456.000,30.540441275,N,104.087192535,E,468.91,3.04,77.93,2,20,0.6,405.3,1,1,1,F,F01,00*48\n" +
            "$THSJDRMSG,104457.000,30.540446401,N,104.087226510,E,468.93,3.32,80.13,2,19,0.6,405.3,1,1,1,F,F01,00*4D\n" +
            "$THSJDRMSG,104458.000,30.540450752,N,104.087261319,E,469.03,3.39,80.47,2,20,0.6,405.3,1,1,1,F,F01,00*44\n" +
            "$THSJDRMSG,104459.000,30.540455282,N,104.087298393,E,469.12,3.61,80.52,2,20,0.6,405.3,1,1,1,F,F01,00*45\n" +
            "$THSJDRMSG,104500.000,30.540460587,N,104.087336302,E,469.31,3.68,81.00,2,13,0.6,405.5,1,1,1,F,F01,00*49\n" +
            "$THSJDRMSG,104501.000,30.540464759,N,104.087379336,E,469.31,4.17,82.93,2,13,0.7,405.4,1,1,1,F,F01,00*47\n" +
            "$THSJDRMSG,104502.000,30.540468812,N,104.087425590,E,469.37,4.46,84.17,2,15,0.7,405.5,1,1,1,F,F01,00*43\n" +
            "$THSJDRMSG,104503.000,30.540470660,N,104.087475538,E,469.37,4.81,84.93,2,15,0.7,405.4,1,1,1,F,F01,00*41\n" +
            "$THSJDRMSG,104504.000,30.540472806,N,104.087527752,E,469.43,5.02,85.28,2,15,0.7,405.5,1,1,1,F,F01,00*4B\n" +
            "$THSJDRMSG,104505.000,30.540474355,N,104.087581515,E,469.50,5.16,85.67,2,17,0.7,405.5,1,1,1,F,F01,00*42\n" +
            "$THSJDRMSG,104506.000,30.540472507,N,104.087637544,E,469.47,5.37,86.43,2,18,0.7,405.5,1,1,1,F,F01,00*43\n" +
            "$THSJDRMSG,104507.000,30.540469110,N,104.087693572,E,469.51,5.38,87.04,2,18,0.7,405.5,1,1,1,F,F01,00*4B\n" +
            "$THSJDRMSG,104508.000,30.540467024,N,104.087749600,E,469.63,5.38,87.49,2,19,0.6,405.6,1,1,1,F,F01,00*47\n" +
            "$THSJDRMSG,104509.000,30.540468991,N,104.087805748,E,469.86,5.38,87.79,2,19,0.6,405.6,1,1,1,F,F01,00*4C\n" +
            "$THSJDRMSG,104510.000,30.540470719,N,104.087865591,E,469.89,5.73,88.17,2,19,0.8,405.7,1,1,1,F,F01,00*4B\n" +
            "$THSJDRMSG,104511.000,30.540472209,N,104.087929845,E,469.90,6.15,88.58,2,17,0.8,405.7,1,1,1,F,F01,00*4F\n" +
            "$THSJDRMSG,104512.000,30.540473640,N,104.087996364,E,470.05,6.37,88.48,2,18,0.7,405.7,1,1,1,F,F01,00*4D\n" +
            "$THSJDRMSG,104513.000,30.540475190,N,104.088067174,E,470.09,6.79,88.37,2,18,0.6,405.8,1,1,1,F,F01,00*4B\n" +
            "$THSJDRMSG,104514.000,30.540476918,N,104.088141799,E,470.08,7.15,88.20,2,17,0.7,405.8,1,1,1,F,F01,00*45\n" +
            "$THSJDRMSG,104515.000,30.540478706,N,104.088217974,E,470.19,7.29,88.04,2,18,0.6,405.8,1,1,1,F,F01,00*41\n" +
            "$THSJDRMSG,104516.000,30.540480494,N,104.088297009,E,470.08,7.57,87.88,2,17,0.7,405.9,1,1,1,F,F01,00*4B\n" +
            "$THSJDRMSG,104517.000,30.540460408,N,104.088377833,E,470.12,7.64,88.71,2,18,0.7,406.0,1,1,1,F,F01,00*48\n" +
            "$THSJDRMSG,104518.000,30.540461838,N,104.088458419,E,470.26,7.71,88.78,2,18,0.7,406.0,1,1,1,F,F01,00*4D\n" +
            "$THSJDRMSG,104519.000,30.540463209,N,104.088541150,E,470.17,7.92,88.75,2,20,0.7,406.0,1,1,1,F,F01,00*4E\n" +
            "$THSJDRMSG,104520.000,30.540447116,N,104.088624597,E,470.22,7.92,89.23,2,16,0.7,406.1,1,1,1,F,F01,00*40\n" +
            "$THSJDRMSG,104521.000,30.540434659,N,104.088708162,E,470.24,7.92,89.62,2,17,0.7,406.1,1,1,1,F,F01,00*4A\n" +
            "$THSJDRMSG,104522.000,30.540428936,N,104.088791370,E,470.28,7.92,89.68,2,15,0.7,406.0,1,1,1,F,F01,00*46\n" +
            "$THSJDRMSG,104523.000,30.540429354,N,104.088874221,E,470.36,7.92,89.55,2,13,0.7,406.1,1,1,1,F,F01,00*4F\n" +
            "$THSJDRMSG,104524.000,30.540422380,N,104.088957310,E,470.45,7.92,89.69,2,12,0.8,406.1,1,1,1,F,F01,00*4C\n" +
            "$THSJDRMSG,104525.000,30.540410042,N,104.089040279,E,470.49,7.92,90.08,2,17,0.8,406.0,1,1,1,F,F01,00*46\n" +
            "$THSJDRMSG,104526.000,30.540405929,N,104.089122772,E,470.38,7.92,90.72,2,19,0.7,406.1,1,1,1,F,F01,00*45\n" +
            "$THSJDRMSG,104527.000,30.540401816,N,104.089203000,E,470.47,7.71,91.35,2,14,0.7,406.1,1,1,1,F,F01,00*45\n" +
            "$THSJDRMSG,104528.000,30.540398300,N,104.089282393,E,470.54,7.64,91.97,2,13,0.7,406.1,1,1,1,F,F01,00*48\n" +
            "$THSJDRMSG,104529.000,30.540394187,N,104.089361906,E,470.58,7.64,92.97,2,13,0.7,406.1,1,1,1,F,F01,00*4D\n" +
            "$THSJDRMSG,104530.000,30.540389061,N,104.089441538,E,470.58,7.64,94.58,2,13,0.7,406.1,1,1,1,F,F01,00*41\n" +
            "$THSJDRMSG,104531.000,30.540381134,N,104.089521050,E,470.50,7.64,95.89,2,20,0.6,406.1,1,1,1,F,F01,00*41\n" +
            "$THSJDRMSG,104532.000,30.540372193,N,104.089599729,E,470.45,7.57,95.36,2,19,0.6,406.1,1,1,1,F,F01,00*43\n" +
            "$THSJDRMSG,104533.000,30.540365338,N,104.089676380,E,470.53,7.36,94.72,2,20,0.6,406.1,1,1,1,F,F01,00*49\n" +
            "$THSJDRMSG,104534.000,30.540358186,N,104.089753270,E,470.47,7.36,93.66,2,13,0.7,406.0,1,1,1,F,F01,00*48\n" +
            "$THSJDRMSG,104535.000,30.540352464,N,104.089827418,E,470.63,7.07,92.75,2,15,0.6,406.0,1,1,1,F,F01,00*4E\n" +
            "$THSJDRMSG,104536.000,30.540348411,N,104.089901090,E,470.58,7.00,91.93,2,19,0.6,405.9,1,1,1,F,F01,00*47\n" +
            "$THSJDRMSG,104537.000,30.540346205,N,104.089972734,E,470.59,6.79,91.35,2,19,0.6,405.9,1,1,1,F,F01,00*44\n" +
            "$THSJDRMSG,104538.000,30.540344477,N,104.090042233,E,470.45,6.58,91.32,2,21,0.6,405.8,1,1,1,F,F01,00*49\n" +
            "$THSJDRMSG,104539.000,30.540342808,N,104.090106487,E,470.46,6.08,92.00,2,21,0.6,405.7,1,1,1,F,F01,00*49\n" +
            "$THSJDRMSG,104540.000,30.540339768,N,104.090166211,E,470.45,5.66,94.92,2,20,0.6,405.6,1,1,1,F,F01,00*48\n" +
            "$THSJDRMSG,104541.000,30.540333033,N,104.090219498,E,470.53,5.09,102.56,2,21,0.6,405.6,1,1,1,F,F01,00*7F\n" +
            "$THSJDRMSG,104542.000,30.540318727,N,104.090267539,E,470.53,4.81,115.08,2,21,0.6,405.6,1,1,1,F,F01,00*78\n" +
            "$THSJDRMSG,104543.000,30.540295362,N,104.090309620,E,470.41,4.74,130.62,2,21,0.6,405.6,1,1,1,F,F01,00*78\n" +
            "$THSJDRMSG,104544.000,30.540264070,N,104.090341568,E,470.34,4.60,146.70,2,22,0.6,405.6,1,1,1,F,F01,00*74\n" +
            "$THSJDRMSG,104545.000,30.540226102,N,104.090364456,E,469.98,4.74,158.68,2,21,0.6,405.4,1,1,1,F,F01,00*70\n" +
            "$THSJDRMSG,104546.000,30.540190637,N,104.090378165,E,469.98,4.17,166.37,2,21,0.6,405.5,1,1,1,F,F01,00*77\n" +
            "$THSJDRMSG,104547.000,30.540158212,N,104.090385079,E,470.13,3.75,176.56,2,21,0.6,405.5,1,1,1,F,F01,00*71\n" +
            "$THSJDRMSG,104548.000,30.540123045,N,104.090383530,E,470.20,3.96,-171.07,2,20,0.6,405.6,1,1,1,F,F01,00*5D\n" +
            "$THSJDRMSG,104549.000,30.540083468,N,104.090373278,E,470.23,4.53,-163.14,2,22,0.6,405.6,1,1,1,F,F01,00*56\n" +
            "$THSJDRMSG,104550.000,30.540038347,N,104.090355396,E,470.13,5.30,-157.99,2,22,0.6,405.6,1,1,1,F,F01,00*54\n" +
            "$THSJDRMSG,104551.000,30.539990067,N,104.090330482,E,470.05,5.87,-153.19,2,20,0.7,405.6,1,1,1,F,F01,00*54\n" +
            "$THSJDRMSG,104552.000,30.539940059,N,104.090300083,E,470.03,6.29,-150.76,2,21,0.7,405.7,1,1,1,F,F01,00*5A\n" +
            "$THSJDRMSG,104553.000,30.539887369,N,104.090265751,E,469.93,6.72,-150.70,2,20,0.7,405.7,1,1,1,F,F01,00*53\n" +
            "$THSJDRMSG,104554.000,30.539833963,N,104.090231180,E,469.91,6.79,-151.14,2,21,0.6,405.7,1,1,1,F,F01,00*5A\n" +
            "$THSJDRMSG,104555.000,30.539780438,N,104.090196967,E,469.92,6.79,-151.18,2,21,0.6,405.6,1,1,1,F,F01,00*5E\n" +
            "$THSJDRMSG,104556.000,30.539725184,N,104.090161800,E,469.91,7.00,-151.08,2,21,0.6,405.6,1,1,1,F,F01,00*55\n" +
            "$THSJDRMSG,104557.000,30.539668560,N,104.090124965,E,470.02,7.21,-150.38,2,21,0.6,405.7,1,1,1,F,F01,00*53\n" +
            "$THSJDRMSG,104558.000,30.539608777,N,104.090087652,E,469.93,7.57,-148.46,2,21,0.6,405.5,1,1,1,F,F01,00*5E\n" +
            "$THSJDRMSG,104559.000,30.539547980,N,104.090046406,E,469.83,7.85,-147.02,2,20,0.7,405.5,1,1,1,F,F01,00*5E\n" +
            "$THSJDRMSG,104600.000,30.539486468,N,104.090005159,E,469.82,7.92,-147.32,2,20,0.7,405.5,1,1,1,F,F01,00*5A\n" +
            "$THSJDRMSG,104601.000,30.539424181,N,104.089965224,E,469.78,7.92,-147.85,2,20,0.7,405.4,1,1,1,F,F01,00*57\n" +
            "$THSJDRMSG,104602.000,30.539357603,N,104.089934468,E,469.71,7.92,-149.48,2,20,0.7,405.3,1,1,1,F,F01,00*51\n" +
            "$THSJDRMSG,104603.000,30.539294064,N,104.089895606,E,469.61,7.92,-149.48,2,19,0.8,405.3,1,1,1,F,F01,00*5D\n" +
            "$THSJDRMSG,104604.000,30.539231956,N,104.089858055,E,469.66,7.71,-149.81,2,19,0.8,405.2,1,1,1,F,F01,00*52\n" +
            "$THSJDRMSG,104605.000,30.539171159,N,104.089820385,E,469.52,7.57,-149.97,2,21,0.7,405.1,1,1,1,F,F01,00*51\n" +
            "$THSJDRMSG,104606.000,30.539113820,N,104.089784861,E,469.46,7.14,-150.45,2,21,0.7,405.0,1,1,1,F,F01,00*55\n" +
            "$THSJDRMSG,104607.000,30.539059997,N,104.089753151,E,469.28,6.65,-151.95,2,20,0.7,404.8,1,1,1,F,F01,00*5D\n" +
            "$THSJDRMSG,104608.000,30.539012909,N,104.089726567,E,469.23,5.80,-151.70,2,20,0.7,404.7,1,1,1,F,F01,00*5E\n" +
            "$THSJDRMSG,104609.000,30.538974166,N,104.089704275,E,469.34,4.81,-150.17,2,20,0.7,404.8,1,1,1,F,F01,00*5B\n" +
            "$THSJDRMSG,104610.000,30.538939595,N,104.089684606,E,469.35,4.31,-152.45,2,19,0.7,404.7,1,1,1,F,F01,00*51\n" +
            "$THSJDRMSG,104611.000,30.538908839,N,104.089669585,E,469.38,3.75,-156.73,2,20,0.6,404.7,1,1,1,F,F01,00*52\n" +
            "$THSJDRMSG,104612.000,30.538883030,N,104.089658380,E,469.29,3.11,-157.61,2,20,0.6,404.6,1,1,1,F,F01,00*52\n" +
            "$THSJDRMSG,104613.000,30.538864374,N,104.089650154,E,469.22,2.26,-157.41,2,21,0.6,404.6,1,1,1,F,F01,00*57\n" +
            "$THSJDRMSG,104614.000,30.538854420,N,104.089645386,E,469.30,1.20,-157.39,2,21,0.6,404.8,1,1,1,F,F01,00*5B\n";

    String str2=
            "$THSJDRMSG,104415.000,30.621217132,N,104.066239834,E,476.33,2.29,-154.25,1, 4,2.8,518.7,1,1,1,F,B01*6E\n" +
            "$THSJDRMSG,104416.000,30.621199846,N,104.066226840,E,476.04,2.29,-140.48,6, 3,99.0,518.2,1,1,1,F,B01*5A\n" +
            "$THSJDRMSG,104417.000,30.621187687,N,104.066211462,E,475.86,2.00,-125.11,6, 2,99.0,518.2,1,1,1,F,B01*53\n" +
            "$THSJDRMSG,104418.000,30.621179283,N,104.066192985,E,475.65,2.00,-111.90,6, 1,99.0,517.9,1,1,1,F,B01*55\n" +
            "$THSJDRMSG,104419.000,30.621174037,N,104.066173077,E,475.40,2.00,-103.07,6, 1,99.0,517.7,1,1,1,F,B01*5B\n" +
            "$THSJDRMSG,104420.000,30.621171832,N,104.066158295,E,475.32,1.43,-96.91,6, 1,99.0,517.6,1,1,1,F,B01*6C\n" +
            "$THSJDRMSG,104421.000,30.621170640,N,104.066140413,E,475.14,1.72,-93.20,6, 1,99.0,517.4,1,1,1,F,B01*6D\n" +
            "$THSJDRMSG,104422.000,30.621169984,N,104.066122413,E,475.05,1.72,-92.16,6, 1,99.0,517.3,1,1,1,F,B01*66\n" +
            "$THSJDRMSG,104423.000,30.621169269,N,104.066098571,E,474.88,2.29,-91.87,6, 1,99.0,517.2,1,1,1,F,B01*69\n" +
                    "ENTER_TCC\n"+
            "$THSJDRMSG,104424.000,30.621168792,N,104.066080570,E,474.98,1.72,-91.71,6, 0,99.0,517.3,1,1,1,F,B01*63\n" +
            "$THSJDRMSG,104425.000,30.621168315,N,104.066062689,E,474.97,1.72,-91.76,6, 0,99.0,517.2,1,1,1,F,B01*69\n" +
            "$THSJDRMSG,104426.000,30.621167779,N,104.066044688,E,475.00,1.72,-92.26,6, 0,99.0,517.2,1,1,1,F,B01*67\n" +
            "$THSJDRMSG,104427.000,30.621167004,N,104.066023827,E,475.05,2.00,-92.84,6, 0,99.0,517.3,1,1,1,F,B01*6B\n" +
            "$THSJDRMSG,104428.000,30.621165872,N,104.065999866,E,475.09,2.29,-93.45,6, 0,99.0,517.3,1,1,1,F,B01*6A\n" +
            "$THSJDRMSG,104429.000,30.621163964,N,104.065967083,E,474.84,3.15,-94.16,6, 0,99.0,517.4,1,1,1,F,B01*65\n" +
            "$THSJDRMSG,104430.000,30.621162057,N,104.065937161,E,474.72,2.86,-94.03,6, 0,99.0,517.2,1,1,1,F,B01*6D\n" +
            "$THSJDRMSG,104431.000,30.621161461,N,104.065916300,E,474.75,2.00,-88.53,6, 0,99.0,517.2,1,1,1,F,B01*69\n" +
            "$THSJDRMSG,104432.000,30.621163070,N,104.065901518,E,474.80,1.43,-77.25,6, 0,99.0,517.2,1,1,1,F,B01*6A\n" +
            "$THSJDRMSG,104433.000,30.621167898,N,104.065887690,E,474.78,1.43,-61.59,6, 0,99.0,517.2,1,1,1,F,B01*66\n" +
            "$THSJDRMSG,104434.000,30.621175885,N,104.065876007,E,474.77,1.43,-44.35,6, 0,99.0,517.2,1,1,1,F,B01*6A\n" +
            "$THSJDRMSG,104435.000,30.621186495,N,104.065867543,E,474.79,1.43,-28.50,6, 0,99.0,517.2,1,1,1,F,B01*68\n" +
            "$THSJDRMSG,104436.000,30.621200681,N,104.065860510,E,474.76,1.72,-19.00,6, 0,99.0,517.2,1,1,1,F,B01*6A\n" +
            "$THSJDRMSG,104437.000,30.621215463,N,104.065855384,E,474.77,1.72,-14.78,6, 0,99.0,517.3,1,1,1,F,B01*6E\n" +
            "$THSJDRMSG,104438.000,30.621230483,N,104.065851092,E,474.79,1.72,-12.69,6, 0,99.0,517.2,1,1,1,F,B01*61\n" +
            "$THSJDRMSG,104439.000,30.621248066,N,104.065846443,E,474.75,2.00,-12.87,6, 0,99.0,517.2,1,1,1,F,B01*64\n" +
            "$THSJDRMSG,104440.000,30.621263146,N,104.065842628,E,474.77,1.72,-11.71,6, 0,99.0,517.2,1,1,1,F,B01*65\n" +
            "$THSJDRMSG,104441.000,30.621280849,N,104.065838814,E,474.63,2.00,-9.32,6, 0,99.0,517.2,1,1,1,F,B01*5E\n" +
            "$THSJDRMSG,104442.000,30.621291041,N,104.065837145,E,474.70,1.14,-7.25,6, 0,99.0,517.2,1,1,1,F,B01*53\n" +
            "$THSJDRMSG,104443.000,30.621298730,N,104.065836072,E,474.71,0.86,-5.52,6, 0,99.0,517.2,1,1,1,F,B01*57\n" +
            "$THSJDRMSG,104444.000,30.621306419,N,104.065835238,E,474.71,0.86,-4.34,6, 0,99.0,517.2,1,1,1,F,B01*50\n" +
            "$THSJDRMSG,104445.000,30.621314108,N,104.065834641,E,474.71,0.86,-3.88,6, 0,99.0,517.1,1,1,1,F,B01*5F\n" +
            "$THSJDRMSG,104446.000,30.621321857,N,104.065834045,E,474.72,0.86,-3.55,6, 0,99.0,517.2,1,1,1,F,B01*5B\n" +
            "$THSJDRMSG,104447.000,30.621329546,N,104.065833569,E,474.71,0.86,-2.99,6, 0,99.0,517.2,1,1,1,F,B01*51\n" +
            "$THSJDRMSG,104448.000,30.621337235,N,104.065833092,E,474.69,0.86,-2.36,6, 0,99.0,517.1,1,1,1,F,B01*5C\n" +
            "$THSJDRMSG,104449.000,30.621344984,N,104.065832734,E,474.66,0.86,-2.14,6, 0,99.0,517.1,1,1,1,F,B01*5D\n" +
            "$THSJDRMSG,104450.000,30.621344984,N,104.065832734,E,474.66,0.00,-2.02,6, 0,99.0,517.1,1,1,1,F,B01*5C\n" +
            "$THSJDRMSG,104451.000,30.621344984,N,104.065832734,E,474.66,0.00,-1.44,6, 0,99.0,517.2,1,1,1,F,B01*5F\n" +
            "$THSJDRMSG,104452.000,30.621350110,N,104.065832615,E,474.65,0.57,-0.36,6, 1,99.0,517.2,1,1,1,F,B01*5A\n" +
            "$THSJDRMSG,104453.000,30.621357858,N,104.065832615,E,474.63,0.86,-1.10,6, 0,99.0,517.2,1,1,1,F,B01*57\n" +
            "$THSJDRMSG,104454.000,30.621368110,N,104.065831661,E,474.63,1.14,-7.67,6, 0,99.0,517.2,1,1,1,F,B01*55\n" +
//                    "EXIT_TCC\n"+
            "$THSJDRMSG,104455.000,30.621378064,N,104.065828681,E,474.65,1.14,-19.76,6, 0,99.0,517.1,1,1,1,F,B01*6B\n" +
            "$THSJDRMSG,104456.000,30.621387303,N,104.065823436,E,474.64,1.14,-34.41,6, 0,99.0,517.2,1,1,1,F,B01*66\n" +
            "$THSJDRMSG,104457.000,30.621396780,N,104.065813303,E,474.59,1.43,-49.57,6, 0,99.0,517.1,1,1,1,F,B01*68\n" +
            "$THSJDRMSG,104458.000,30.621403813,N,104.065800905,E,474.58,1.43,-61.79,6, 0,99.0,517.2,1,1,1,F,B01*63\n" +
            "$THSJDRMSG,104459.000,30.621408761,N,104.065787077,E,474.59,1.43,-71.07,6, 0,99.0,517.2,1,1,1,F,B01*66\n" +
            "$THSJDRMSG,104500.000,30.621412635,N,104.065769672,E,474.54,1.72,-78.35,6, 0,99.0,517.2,1,1,1,F,B01*64\n" +
            "$THSJDRMSG,104501.000,30.621414840,N,104.065751910,E,474.54,1.72,-84.58,6, 0,99.0,517.2,1,1,1,F,B01*67\n" +
            "$THSJDRMSG,104502.000,30.621415079,N,104.065734029,E,474.53,1.72,-92.99,6, 0,99.0,517.1,1,1,1,F,B01*69\n" +
            "$THSJDRMSG,104503.000,30.621411979,N,104.065716505,E,474.49,1.72,-108.61,6, 0,99.0,517.1,1,1,1,F,B01*50\n" +
            "$THSJDRMSG,104504.000,30.621404350,N,104.065701008,E,474.45,1.72,-128.35,6, 0,99.0,517.1,1,1,1,F,B01*53\n" +
            "$THSJDRMSG,104505.000,30.621392369,N,104.065689802,E,474.43,1.72,-150.69,6, 0,99.0,517.1,1,1,1,F,B01*53\n" +
            "$THSJDRMSG,104506.000,30.621377707,N,104.065684319,E,474.43,1.72,-171.22,6, 0,99.0,517.1,1,1,1,F,B01*57\n" +
            "$THSJDRMSG,104507.000,30.621357143,N,104.065683246,E,474.32,2.29,177.83,6, 0,99.0,517.2,1,1,1,F,B01*76\n" +
            "$THSJDRMSG,104508.000,30.621334016,N,104.065684915,E,474.27,2.58,176.12,6, 0,99.0,517.3,1,1,1,F,B01*7D\n" +
            "$THSJDRMSG,104509.000,30.621313453,N,104.065686584,E,474.34,2.29,176.13,6, 0,99.0,517.3,1,1,1,F,B01*7F\n" +
            "$THSJDRMSG,104510.000,30.621290326,N,104.065688372,E,474.30,2.57,176.21,6, 0,99.0,517.3,1,1,1,F,B01*75\n" +
            "$THSJDRMSG,104511.000,30.621267259,N,104.065690160,E,474.32,2.58,176.03,6, 0,99.0,517.3,1,1,1,F,B01*70\n" +
            "$THSJDRMSG,104512.000,30.621244133,N,104.065692067,E,474.30,2.57,176.08,6, 0,99.0,517.3,1,1,1,F,B01*7F\n" +
            "$THSJDRMSG,104513.000,30.621221006,N,104.065693855,E,474.30,2.58,176.04,6, 0,99.0,517.3,1,1,1,F,B01*71\n" +
            "$THSJDRMSG,104514.000,30.621197879,N,104.065695763,E,474.29,2.57,176.14,6, 0,99.0,517.3,1,1,1,F,B01*72\n" +
            "$THSJDRMSG,104515.000,30.621174753,N,104.065697551,E,474.30,2.57,176.45,6, 0,99.0,517.3,1,1,1,F,B01*74\n" +
            "$THSJDRMSG,104516.000,30.621151626,N,104.065699100,E,474.32,2.57,176.57,6, 0,99.0,517.3,1,1,1,F,B01*7C\n" +
            "$THSJDRMSG,104517.000,30.621128500,N,104.065700769,E,474.31,2.57,176.67,6, 0,99.0,517.4,1,1,1,F,B01*7B\n" +
            "$THSJDRMSG,104518.000,30.621105373,N,104.065702200,E,474.32,2.58,176.93,6, 0,99.0,517.2,1,1,1,F,B01*70\n" +
            "$THSJDRMSG,104519.000,30.621082187,N,104.065703630,E,474.32,2.58,177.26,6, 0,99.0,517.3,1,1,1,F,B01*7E\n" +
            "$THSJDRMSG,104520.000,30.621061623,N,104.065704584,E,474.38,2.29,177.82,6, 0,99.0,517.3,1,1,1,F,B01*79\n" +
            "$THSJDRMSG,104521.000,30.621041059,N,104.065705419,E,474.37,2.29,178.22,6, 0,99.0,517.3,1,1,1,F,B01*7F\n" +
            "$THSJDRMSG,104522.000,30.621020436,N,104.065706134,E,474.36,2.29,178.38,6, 0,99.0,517.3,1,1,1,F,B01*75\n" +
            "$THSJDRMSG,104523.000,30.620999873,N,104.065706849,E,474.39,2.29,177.92,6, 0,99.0,517.3,1,1,1,F,B01*70\n" +
            "$THSJDRMSG,104524.000,30.620979309,N,104.065707922,E,474.46,2.29,177.19,6, 0,99.0,517.3,1,1,1,F,B01*79\n" +
            "$THSJDRMSG,104525.000,30.620953560,N,104.065709591,E,474.34,2.86,176.51,6, 0,99.0,517.4,1,1,1,F,B01*79\n" +
            "$THSJDRMSG,104526.000,30.620927870,N,104.065711617,E,474.34,2.86,176.07,6, 0,99.0,517.4,1,1,1,F,B01*72\n" +
            "$THSJDRMSG,104527.000,30.620902181,N,104.065713525,E,474.32,2.86,176.66,6, 0,99.0,517.4,1,1,1,F,B01*72\n" +
            "$THSJDRMSG,104528.000,30.620876491,N,104.065715075,E,474.30,2.86,177.10,6, 0,99.0,517.3,1,1,1,F,B01*78\n" +
            "$THSJDRMSG,104529.000,30.620853364,N,104.065716386,E,474.38,2.57,177.43,6, 0,99.0,517.3,1,1,1,F,B01*7D\n" +
            "$THSJDRMSG,104530.000,30.620830178,N,104.065717578,E,474.37,2.57,177.84,6, 0,99.0,517.3,1,1,1,F,B01*7D\n" +
            "$THSJDRMSG,104531.000,30.620807052,N,104.065718412,E,474.34,2.58,178.27,6, 0,99.0,517.3,1,1,1,F,B01*79\n" +
            "$THSJDRMSG,104532.000,30.620783865,N,104.065719366,E,474.30,2.57,177.76,6, 0,99.0,517.3,1,1,1,F,B01*70\n" +
            "$THSJDRMSG,104533.000,30.620763302,N,104.065720320,E,474.34,2.29,177.55,6, 0,99.0,517.2,1,1,1,F,B01*70\n" +
            "$THSJDRMSG,104534.000,30.620742738,N,104.065721393,E,474.28,2.29,177.50,6, 0,99.0,517.2,1,1,1,F,B01*78\n" +
            "$THSJDRMSG,104535.000,30.620727301,N,104.065722108,E,474.30,1.72,177.50,6, 0,99.0,517.2,1,1,1,F,B01*73\n" +
            "$THSJDRMSG,104536.000,30.620714426,N,104.065722823,E,474.30,1.43,177.48,6, 0,99.0,517.1,1,1,1,F,B01*7A\n" +
            "$THSJDRMSG,104537.000,30.620704114,N,104.065723300,E,474.32,1.14,177.49,6, 0,99.0,517.2,1,1,1,F,B01*77\n" +
            "$THSJDRMSG,104538.000,30.620696425,N,104.065723658,E,474.36,0.86,179.62,6, 0,99.0,517.2,1,1,1,F,B01*74\n" +
            "$THSJDRMSG,104539.000,30.620686114,N,104.065722942,E,474.34,1.14,-172.43,6, 0,99.0,517.2,1,1,1,F,B01*5B\n" +
            "$THSJDRMSG,104540.000,30.620676160,N,104.065719962,E,474.34,1.14,-158.67,6, 0,99.0,517.2,1,1,1,F,B01*5D\n" +
            "$THSJDRMSG,104541.000,30.620664954,N,104.065712810,E,474.29,1.43,-142.48,6, 0,99.0,517.2,1,1,1,F,B01*57\n" +
            "$THSJDRMSG,104542.000,30.620655954,N,104.065702200,E,474.28,1.43,-126.09,6, 0,99.0,517.3,1,1,1,F,B01*5B\n" +
            "$THSJDRMSG,104543.000,30.620648444,N,104.065686584,E,474.26,1.72,-113.21,6, 0,99.0,517.3,1,1,1,F,B01*5C\n" +
            "$THSJDRMSG,104544.000,30.620643318,N,104.065669656,E,474.30,1.72,-106.26,6, 0,99.0,517.3,1,1,1,F,B01*57\n" +
            "$THSJDRMSG,104545.000,30.620638788,N,104.065649271,E,474.24,2.00,-102.71,6, 0,99.0,517.3,1,1,1,F,B01*51\n" +
            "$THSJDRMSG,104546.000,30.620635211,N,104.065628767,E,474.17,2.00,-100.29,6, 0,99.0,517.2,1,1,1,F,B01*51\n" +
            "$THSJDRMSG,104547.000,30.620632887,N,104.065611124,E,474.16,1.72,-95.96,6, 0,99.0,517.2,1,1,1,F,B01*67\n" +
            "$THSJDRMSG,104548.000,30.620632708,N,104.065596104,E,474.19,1.43,-84.64,6, 0,99.0,517.2,1,1,1,F,B01*6E\n" +
            "$THSJDRMSG,104549.000,30.620635152,N,104.065584540,E,474.21,1.14,-69.51,6, 0,99.0,517.2,1,1,1,F,B01*6A\n" +
            "$THSJDRMSG,104550.000,30.620641291,N,104.065571427,E,474.14,1.43,-52.18,6, 0,99.0,517.2,1,1,1,F,B01*66\n" +
            "$THSJDRMSG,104551.000,30.620650530,N,104.065561175,E,474.14,1.43,-34.62,6, 0,99.0,517.2,1,1,1,F,B01*65\n" +
            "$THSJDRMSG,104552.000,30.620664358,N,104.065553188,E,474.13,1.72,-20.15,6, 0,99.0,517.2,1,1,1,F,B01*6A\n" +
            "$THSJDRMSG,104553.000,30.620679319,N,104.065548897,E,474.18,1.72,-10.89,6, 0,99.0,517.2,1,1,1,F,B01*62\n" +
            "$THSJDRMSG,104554.000,30.620694578,N,104.065546393,E,474.23,1.72,-6.52,6, 0,99.0,517.2,1,1,1,F,B01*5F\n" +
            "$THSJDRMSG,104555.000,30.620715082,N,104.065544009,E,474.17,2.29,-5.09,6, 0,99.0,517.3,1,1,1,F,B01*52\n" +
            "$THSJDRMSG,104556.000,30.620738208,N,104.065541863,E,474.21,2.58,-3.75,6, 0,99.0,517.4,1,1,1,F,B01*56\n" +
            "$THSJDRMSG,104557.000,30.620766461,N,104.065539718,E,474.24,3.15,-4.28,6, 0,99.0,517.4,1,1,1,F,B01*5B\n" +
            "$THSJDRMSG,104558.000,30.620799780,N,104.065536261,E,474.19,3.72,-5.66,6, 0,99.0,517.6,1,1,1,F,B01*5A\n" +
            "$THSJDRMSG,104559.000,30.620835662,N,104.065531850,E,474.12,4.00,-6.57,6, 0,99.0,517.6,1,1,1,F,B01*58\n" +
            "$THSJDRMSG,104600.000,30.620873988,N,104.065526366,E,473.99,4.29,-7.06,6, 0,99.0,517.6,1,1,1,F,B01*5C\n" +
            "$THSJDRMSG,104601.000,30.620912313,N,104.065520883,E,473.96,4.29,-7.08,6, 0,99.0,517.6,1,1,1,F,B01*54\n" +
            "$THSJDRMSG,104602.000,30.620948076,N,104.065515637,E,474.08,4.01,-7.10,6, 0,99.0,517.6,1,1,1,F,B01*5C\n" +
            "$THSJDRMSG,104603.000,30.620983839,N,104.065510511,E,474.05,4.01,-7.11,6, 0,99.0,517.6,1,1,1,F,B01*57\n" +
            "$THSJDRMSG,104604.000,30.621017098,N,104.065505743,E,473.98,3.72,-6.77,6, 0,99.0,517.6,1,1,1,F,B01*56\n" +
            "$THSJDRMSG,104605.000,30.621047854,N,104.065502644,E,473.77,3.43,-1.37,6, 0,99.0,517.4,1,1,1,F,B01*59\n" +
            "$THSJDRMSG,104606.000,30.621070921,N,104.065504432,E,473.76,2.57,9.83,6, 0,99.0,517.4,1,1,1,F,B01*77\n" +
            "$THSJDRMSG,104607.000,30.621088326,N,104.065509796,E,473.73,2.00,20.83,6, 0,99.0,517.3,1,1,1,F,B01*47\n" +
            "$THSJDRMSG,104608.000,30.621097445,N,104.065515280,E,473.79,1.14,34.26,6, 0,99.0,517.2,1,1,1,F,B01*4C\n" +
            "$THSJDRMSG,104609.000,30.621106803,N,104.065525413,E,473.73,1.43,50.20,6, 0,99.0,517.2,1,1,1,F,B01*49\n" +
            "$THSJDRMSG,104610.000,30.621112227,N,104.065535665,E,473.75,1.14,65.49,6, 0,99.0,517.2,1,1,1,F,B01*47\n" +
            "$THSJDRMSG,104611.000,30.621115446,N,104.065546989,E,473.70,1.14,76.60,6, 0,99.0,517.1,1,1,1,F,B01*46\n" +
            "$THSJDRMSG,104612.000,30.621117055,N,104.065555692,E,473.68,0.86,78.45,6, 0,99.0,517.1,1,1,1,F,B01*4C\n" +
            "$THSJDRMSG,104613.000,30.621117055,N,104.065555692,E,473.68,0.00,78.46,6, 0,99.0,517.1,1,1,1,F,B01*40\n" +
            "$THSJDRMSG,104614.000,30.621117055,N,104.065555692,E,473.68,0.00,78.44,6, 0,99.0,517.1,1,1,1,F,B01*45\n" +
            "$THSJDRMSG,104615.000,30.621117055,N,104.065555692,E,473.68,0.00,78.42,6, 0,99.0,517.1,1,1,1,F,B01*42\n" +
            "$THSJDRMSG,104616.000,30.621117055,N,104.065555692,E,473.68,0.00,78.41,6, 0,99.0,517.1,1,1,1,F,B01*42\n" +
            "$THSJDRMSG,104617.000,30.621117055,N,104.065555692,E,473.68,0.00,78.40,6, 0,99.0,517.1,1,1,1,F,B01*42\n" +
            "$THSJDRMSG,104618.000,30.621117055,N,104.065555692,E,473.68,0.00,78.36,6, 0,99.0,517.1,1,1,1,F,B01*4C\n" +
            "$THSJDRMSG,104619.000,30.621117055,N,104.065555692,E,473.68,0.00,78.34,6, 0,99.0,517.1,1,1,1,F,B01*4F\n" +
            "$THSJDRMSG,104620.000,30.621117055,N,104.065555692,E,473.68,0.00,78.33,6, 0,99.0,517.1,1,1,1,F,B01*42\n" +
            "$THSJDRMSG,104621.000,30.621117055,N,104.065555692,E,473.68,0.00,78.33,6, 0,99.0,517.1,1,1,1,F,B01*43\n" +
            "$THSJDRMSG,104622.000,30.621117055,N,104.065555692,E,473.68,0.00,78.33,6, 0,99.0,517.1,1,1,1,F,B01*40\n" +
            "$THSJDRMSG,104623.000,30.621117055,N,104.065555692,E,473.68,0.00,78.34,6, 0,99.0,517.1,1,1,1,F,B01*46\n" +
            "$THSJDRMSG,104624.000,30.621117055,N,104.065555692,E,473.68,0.00,78.33,6, 0,99.0,517.1,1,1,1,F,B01*46\n" +
            "$THSJDRMSG,104625.000,30.621117055,N,104.065555692,E,473.68,0.00,78.33,6, 0,99.0,517.1,1,1,1,F,B01*47\n" +
            "$THSJDRMSG,104626.000,30.621117055,N,104.065555692,E,473.68,0.00,78.33,6, 0,99.0,517.1,1,1,1,F,B01*44\n" +
            "$THSJDRMSG,104627.000,30.621117055,N,104.065555692,E,473.68,0.00,78.32,6, 0,99.0,517.1,1,1,1,F,B01*44\n" +
            "$THSJDRMSG,104628.000,30.621117055,N,104.065555692,E,473.68,0.00,80.21,6, 0,99.0,517.1,1,1,1,F,B01*4E\n" +
            "$THSJDRMSG,104629.000,30.621117055,N,104.065555692,E,473.68,0.00,81.90,6, 0,99.0,517.1,1,1,1,F,B01*44\n" +
            "$THSJDRMSG,104630.000,30.621117771,N,104.065561652,E,473.67,0.57,81.78,6, 0,99.0,517.1,1,1,1,F,B01*4D\n" +
            "$THSJDRMSG,104631.000,30.621118903,N,104.065570593,E,473.66,0.86,81.67,6, 0,99.0,517.2,1,1,1,F,B01*46\n" +
            "$THSJDRMSG,104632.000,30.621120751,N,104.065585375,E,473.59,1.43,81.69,6, 0,99.0,517.2,1,1,1,F,B01*49\n" +
            "$THSJDRMSG,104633.000,30.621122599,N,104.065600157,E,473.58,1.43,81.89,6, 0,99.0,517.2,1,1,1,F,B01*4F\n" +
            "$THSJDRMSG,104634.000,30.621123910,N,104.065612078,E,473.60,1.14,84.15,6, 0,99.0,517.1,1,1,1,F,B01*41\n" +
            "$THSJDRMSG,104635.000,30.621124327,N,104.065623999,E,473.60,1.14,91.51,6, 0,99.0,517.2,1,1,1,F,B01*4A\n" +
            "$THSJDRMSG,104636.000,30.621122777,N,104.065635800,E,473.59,1.14,104.16,6, 0,99.0,517.2,1,1,1,F,B01*7C\n" +
            "$THSJDRMSG,104637.000,30.621118844,N,104.065646768,E,473.58,1.14,118.93,6, 0,99.0,517.2,1,1,1,F,B01*7F\n" +
            "$THSJDRMSG,104638.000,30.621111035,N,104.065658569,E,473.54,1.43,134.29,6, 0,99.0,517.2,1,1,1,F,B01*7A\n" +
            "$THSJDRMSG,104639.000,30.621102870,N,104.065665960,E,473.57,1.14,147.84,6, 0,99.0,517.2,1,1,1,F,B01*79\n" +
            "$THSJDRMSG,104640.000,30.621091306,N,104.065672398,E,473.52,1.43,158.87,6, 0,99.0,517.2,1,1,1,F,B01*77\n" +
            "$THSJDRMSG,104641.000,30.621081471,N,104.065675974,E,473.56,1.14,165.10,6, 0,99.0,517.1,1,1,1,F,B01*7A\n" +
            "$THSJDRMSG,104642.000,30.621068954,N,104.065679431,E,473.54,1.43,168.13,6, 0,99.0,517.1,1,1,1,F,B01*7A\n" +
            "$THSJDRMSG,104643.000,30.621056318,N,104.065682173,E,473.57,1.43,170.97,6, 0,99.0,517.2,1,1,1,F,B01*76\n" +
            "$THSJDRMSG,104644.000,30.621041000,N,104.065684676,E,473.56,1.72,172.95,6, 0,99.0,517.2,1,1,1,F,B01*7A\n" +
            "$THSJDRMSG,104645.000,30.621025681,N,104.065686703,E,473.58,1.70,173.73,6, 0,99.0,517.2,1,1,1,F,B01*72\n" +
            "$THSJDRMSG,104646.000,30.621007740,N,104.065688848,E,473.54,2.00,174.26,6, 0,99.0,517.2,1,1,1,F,B01*7C\n" +
            "$THSJDRMSG,104647.000,30.620987236,N,104.065691471,E,473.53,2.29,173.49,6, 0,99.0,517.3,1,1,1,F,B01*74\n" +
            "$THSJDRMSG,104648.000,30.620966792,N,104.065694332,E,473.55,2.29,172.95,6, 0,99.0,517.3,1,1,1,F,B01*7C\n" +
            "$THSJDRMSG,104649.000,30.620946348,N,104.065697312,E,473.54,2.29,172.71,6, 0,99.0,517.3,1,1,1,F,B01*76\n" +
            "$THSJDRMSG,104650.000,30.620925903,N,104.065700412,E,473.56,2.29,172.62,6, 0,99.0,517.3,1,1,1,F,B01*76\n" +
            "$THSJDRMSG,104651.000,30.620905519,N,104.065703392,E,473.62,2.29,172.65,6, 0,99.0,517.3,1,1,1,F,B01*7E\n" +
            "$THSJDRMSG,104652.000,30.620882511,N,104.065706849,E,473.59,2.58,172.71,6, 0,99.0,517.4,1,1,1,F,B01*7F\n" +
            "$THSJDRMSG,104653.000,30.620857000,N,104.065710664,E,473.54,2.86,172.90,6, 0,99.0,517.3,1,1,1,F,B01*73\n" +
            "$THSJDRMSG,104654.000,30.620831430,N,104.065714240,E,473.54,2.86,173.14,6, 0,99.0,517.3,1,1,1,F,B01*78\n" +
            "$THSJDRMSG,104655.000,30.620805860,N,104.065717697,E,473.51,2.86,173.49,6, 0,99.0,517.3,1,1,1,F,B01*77\n" +
            "$THSJDRMSG,104656.000,30.620780230,N,104.065721035,E,473.48,2.86,173.88,6, 0,99.0,517.3,1,1,1,F,B01*77\n" +
            "$THSJDRMSG,104657.000,30.620757222,N,104.065723777,E,473.47,2.57,174.31,6, 0,99.0,517.3,1,1,1,F,B01*7A\n" +
            "$THSJDRMSG,104658.000,30.620736718,N,104.065726042,E,473.43,2.29,174.64,6, 0,99.0,517.2,1,1,1,F,B01*76\n" +
            "$THSJDRMSG,104659.000,30.620721281,N,104.065727472,E,473.49,1.72,177.48,6, 0,99.0,517.2,1,1,1,F,B01*78\n" +
            "$THSJDRMSG,104700.000,30.620705843,N,104.065726995,E,473.45,1.72,-174.43,6, 0,99.0,517.2,1,1,1,F,B01*5B\n" +
            "$THSJDRMSG,104701.000,30.620693326,N,104.065723896,E,473.46,1.43,-162.65,6, 0,99.0,517.2,1,1,1,F,B01*59\n" +
            "$THSJDRMSG,104702.000,30.620681763,N,104.065717459,E,473.45,1.43,-148.72,6, 0,99.0,517.3,1,1,1,F,B01*58\n" +
            "$THSJDRMSG,104703.000,30.620671928,N,104.065707803,E,473.46,1.43,-133.84,6, 0,99.0,517.2,1,1,1,F,B01*52\n" +
            "$THSJDRMSG,104704.000,30.620664418,N,104.065695643,E,473.48,1.43,-119.25,6, 0,99.0,517.3,1,1,1,F,B01*53\n" +
            "$THSJDRMSG,104705.000,30.620657384,N,104.065676451,E,473.36,2.00,-108.55,6, 0,99.0,517.3,1,1,1,F,B01*56\n" +
            "$THSJDRMSG,104706.000,30.620652497,N,104.065656304,E,473.36,2.00,-104.10,6, 0,99.0,517.3,1,1,1,F,B01*5D\n" +
            "$THSJDRMSG,104707.000,30.620648444,N,104.065635920,E,473.32,2.00,-102.23,6, 0,99.0,517.2,1,1,1,F,B01*53\n" +
            "$THSJDRMSG,104708.000,30.620645404,N,104.065618277,E,473.32,1.72,-100.15,6, 0,99.0,517.2,1,1,1,F,B01*52\n" +
            "$THSJDRMSG,104709.000,30.620644152,N,104.065603375,E,473.33,1.43,-92.14,6, 0,99.0,517.2,1,1,1,F,B01*65\n" +
            "$THSJDRMSG,104710.000,30.620644689,N,104.065591455,E,473.34,1.14,-81.36,6, 0,99.0,517.2,1,1,1,F,B01*66\n" +
            "$THSJDRMSG,104711.000,30.620647550,N,104.065580010,E,473.32,1.14,-65.52,6, 0,99.0,517.2,1,1,1,F,B01*68\n" +
            "$THSJDRMSG,104712.000,30.620653093,N,104.065569997,E,473.32,1.14,-47.95,6, 0,99.0,517.2,1,1,1,F,B01*6E\n" +
            "$THSJDRMSG,104713.000,30.620663047,N,104.065560579,E,473.31,1.43,-29.41,6, 0,99.0,517.2,1,1,1,F,B01*60\n" +
            "$THSJDRMSG,104714.000,30.620677292,N,104.065553784,E,473.32,1.72,-16.95,6, 0,99.0,517.2,1,1,1,F,B01*6C\n" +
            "$THSJDRMSG,104715.000,30.620694757,N,104.065548658,E,473.21,2.00,-12.41,6, 0,99.0,517.3,1,1,1,F,B01*6E\n" +
            "$THSJDRMSG,104716.000,30.620707393,N,104.065545559,E,473.16,1.43,-11.43,6, 0,99.0,517.1,1,1,1,F,B01*66\n" +
            "$THSJDRMSG,104717.000,30.620712399,N,104.065544367,E,473.19,0.57,-10.93,6, 0,99.0,517.1,1,1,1,F,B01*64\n" +
            "$THSJDRMSG,104718.000,30.620714962,N,104.065543890,E,473.20,0.29,-10.22,6, 0,99.0,517.1,1,1,1,F,B01*6E\n" +
            "$THSJDRMSG,104719.000,30.620717466,N,104.065543413,E,473.20,0.29,-9.93,6, 0,99.0,517.1,1,1,1,F,B01*50\n" +
            "$THSJDRMSG,104734.000,30.620720029,N,104.065542817,E,473.20,0.29,-9.76,6, 0,99.0,517.1,1,1,1,F,B01*56\n" +
            "$THSJDRMSG,104735.000,30.620725095,N,104.065541863,E,473.22,0.57,-10.12,6, 0,99.0,517.2,1,1,1,F,B01*67\n" +
            "$THSJDRMSG,104736.000,30.620735228,N,104.065539718,E,473.20,1.14,-9.48,6, 0,99.0,517.2,1,1,1,F,B01*5E\n" +
            "$THSJDRMSG,104737.000,30.620753050,N,104.065536499,E,473.09,2.00,-8.44,6, 0,99.0,517.2,1,1,1,F,B01*57\n" +
            "$THSJDRMSG,104738.000,30.620770931,N,104.065533638,E,473.14,2.00,-7.40,6, 0,99.0,517.3,1,1,1,F,B01*5D\n" +
            "$THSJDRMSG,104739.000,30.620791376,N,104.065530777,E,473.12,2.29,-6.72,6, 0,99.0,517.3,1,1,1,F,B01*5E\n" +
            "$THSJDRMSG,104740.000,30.620811820,N,104.065527916,E,473.16,2.29,-6.75,6, 0,99.0,517.3,1,1,1,F,B01*53\n" +
            "$THSJDRMSG,104741.000,30.620834827,N,104.065524697,E,473.12,2.57,-7.14,6, 0,99.0,517.3,1,1,1,F,B01*5C\n" +
            "$THSJDRMSG,104742.000,30.620860338,N,104.065520883,E,473.04,2.86,-7.51,6, 0,99.0,517.4,1,1,1,F,B01*59\n" +
            "$THSJDRMSG,104743.000,30.620883286,N,104.065517306,E,473.09,2.58,-7.69,6, 0,99.0,517.3,1,1,1,F,B01*51\n" +
            "$THSJDRMSG,104744.000,30.620906293,N,104.065513730,E,473.06,2.57,-7.56,6, 0,99.0,517.3,1,1,1,F,B01*57\n" +
            "$THSJDRMSG,104745.000,30.620929241,N,104.065510273,E,473.04,2.57,-7.23,6, 0,99.0,517.3,1,1,1,F,B01*55\n" +
            "$THSJDRMSG,104746.000,30.620952249,N,104.065506935,E,473.02,2.57,-6.85,6, 0,99.0,517.3,1,1,1,F,B01*57\n" +
            "$THSJDRMSG,104747.000,30.620975256,N,104.065503836,E,473.01,2.57,-6.52,6, 0,99.0,517.3,1,1,1,F,B01*53\n" +
            "$THSJDRMSG,104748.000,30.620995760,N,104.065501213,E,473.06,2.29,-6.10,6, 0,99.0,517.3,1,1,1,F,B01*55\n" +
            "$THSJDRMSG,104749.000,30.621016264,N,104.065498710,E,473.04,2.29,-5.75,6, 0,99.0,517.3,1,1,1,F,B01*53\n" +
            "$THSJDRMSG,104750.000,30.621036708,N,104.065496325,E,472.95,2.29,-5.43,6, 0,99.0,517.2,1,1,1,F,B01*57\n" +
            "$THSJDRMSG,104751.000,30.621054709,N,104.065494418,E,472.75,2.00,-5.34,6, 0,99.0,517.1,1,1,1,F,B01*5E\n" +
            "$THSJDRMSG,104752.000,30.621059835,N,104.065493822,E,472.79,0.57,-5.31,6, 0,99.0,517.1,1,1,1,F,B01*5B\n" +
            "$THSJDRMSG,104756.000,30.621064961,N,104.065493345,E,472.80,0.57,-4.77,6, 0,99.0,517.2,1,1,1,F,B01*5D\n" +
            "$THSJDRMSG,104757.000,30.621077776,N,104.065492153,E,472.71,1.43,-4.58,6, 0,99.0,517.1,1,1,1,F,B01*56\n" +
            "$THSJDRMSG,104758.000,30.621090591,N,104.065490961,E,472.78,1.43,-4.34,6, 0,99.0,517.2,1,1,1,F,B01*50\n" +
            "$THSJDRMSG,104759.000,30.621111095,N,104.065488935,E,472.75,2.29,-5.76,6, 0,99.0,517.2,1,1,1,F,B01*55\n" +
            "$THSJDRMSG,104800.000,30.621134162,N,104.065485835,E,472.86,2.58,-6.60,6, 0,99.0,517.5,1,1,1,F,B01*5D\n" +
            "$THSJDRMSG,104801.000,30.621167421,N,104.065481424,E,472.61,3.72,-6.45,6, 0,99.0,517.5,1,1,1,F,B01*57\n" +
            "$THSJDRMSG,104802.000,30.621203244,N,104.065476894,E,472.56,4.01,-6.27,6, 0,99.0,517.5,1,1,1,F,B01*5C\n" +
            "$THSJDRMSG,104803.000,30.621239066,N,104.065472007,E,472.54,4.01,-7.16,6, 0,99.0,517.5,1,1,1,F,B01*51\n" +
            "$THSJDRMSG,104804.000,30.621274710,N,104.065466166,E,472.38,4.01,-8.58,6, 0,99.0,517.4,1,1,1,F,B01*54\n" +
            "$THSJDRMSG,104805.000,30.621305227,N,104.065460205,E,472.39,3.43,-10.59,6, 0,99.0,517.4,1,1,1,F,B01*6B\n" +
            "$THSJDRMSG,104806.000,30.621330321,N,104.065453529,E,472.42,2.86,-16.09,6, 0,99.0,517.3,1,1,1,F,B01*60\n" +
            "$THSJDRMSG,104807.000,30.621349275,N,104.065444469,E,472.46,2.29,-30.62,6, 0,99.0,517.2,1,1,1,F,B01*65\n" +
            "$THSJDRMSG,104808.000,30.621364951,N,104.065429091,E,472.35,2.29,-50.73,6, 0,99.0,517.1,1,1,1,F,B01*61\n" +
            "$THSJDRMSG,104809.000,30.621375144,N,104.065408349,E,472.23,2.29,-69.23,6, 0,99.0,517.1,1,1,1,F,B01*61\n" +
            "$THSJDRMSG,104810.000,30.621379197,N,104.065388083,E,472.23,2.00,-82.20,6, 0,99.0,517.1,1,1,1,F,B01*6C\n" +
            "$THSJDRMSG,104811.000,30.621380031,N,104.065370083,E,472.26,1.72,-89.97,6, 0,99.0,517.2,1,1,1,F,B01*66\n" +
            "$THSJDRMSG,104812.000,30.621379375,N,104.065352201,E,472.30,1.72,-93.67,6, 0,99.0,517.2,1,1,1,F,B01*6B\n" +
            "$THSJDRMSG,104813.000,30.621377945,N,104.065331340,E,472.33,2.00,-94.95,6, 0,99.0,517.2,1,1,1,F,B01*63\n" +
            "$THSJDRMSG,104814.000,30.621376097,N,104.065307498,E,472.30,2.29,-95.13,6, 0,99.0,517.3,1,1,1,F,B01*62\n" +
            "$THSJDRMSG,104815.000,30.621374071,N,104.065280676,E,472.30,2.57,-95.06,6, 0,99.0,517.4,1,1,1,F,B01*6F\n" +
            "$THSJDRMSG,104816.000,30.621371508,N,104.065247893,E,472.21,3.15,-95.67,6, 0,99.0,517.4,1,1,1,F,B01*6C\n" +
            "$THSJDRMSG,104817.000,30.621367514,N,104.065212250,E,472.09,3.43,-99.61,6, 0,99.0,517.3,1,1,1,F,B01*66\n" +
            "$THSJDRMSG,104818.000,30.621359825,N,104.065180659,E,472.11,3.15,-112.12,6, 0,99.0,517.2,1,1,1,F,B01*53\n" +
            "$THSJDRMSG,104819.000,30.621345818,N,104.065155745,E,472.07,2.86,-132.47,6, 0,99.0,517.2,1,1,1,F,B01*5B\n" +
            "$THSJDRMSG,104820.000,30.621324837,N,104.065138817,E,471.92,2.86,-154.68,6, 0,99.0,517.1,1,1,1,F,B01*59\n" +
            "$THSJDRMSG,104821.000,30.621302485,N,104.065131903,E,471.89,2.58,-172.39,6, 0,99.0,517.1,1,1,1,F,B01*5D\n" +
            "$THSJDRMSG,104822.000,30.621279359,N,104.065130591,E,471.83,2.57,179.95,6, 0,99.0,517.2,1,1,1,F,B01*75\n" +
            "$THSJDRMSG,104823.000,30.621258795,N,104.065131307,E,471.87,2.29,177.00,6, 0,99.0,517.2,1,1,1,F,B01*74\n" +
            "$THSJDRMSG,104824.000,30.621238232,N,104.065132856,E,471.86,2.29,176.05,6, 0,99.0,517.2,1,1,1,F,B01*74\n" +
            "$THSJDRMSG,104825.000,30.621217668,N,104.065134764,E,471.86,2.29,175.08,6, 0,99.0,517.3,1,1,1,F,B01*74\n" +
            "$THSJDRMSG,104826.000,30.621197164,N,104.065136909,E,471.85,2.29,174.17,6, 0,99.0,517.2,1,1,1,F,B01*7D\n" +
            "$THSJDRMSG,104827.000,30.621176720,N,104.065139532,E,471.85,2.29,173.90,6, 0,99.0,517.2,1,1,1,F,B01*76\n" +
            "$THSJDRMSG,104828.000,30.621156216,N,104.065142035,E,471.85,2.29,173.88,6, 0,99.0,517.2,1,1,1,F,B01*7C\n" +
            "$THSJDRMSG,104829.000,30.621135771,N,104.065144658,E,471.86,2.29,173.20,6, 0,99.0,517.2,1,1,1,F,B01*76\n" +
            "$THSJDRMSG,104830.000,30.621115386,N,104.065148354,E,471.86,2.29,168.10,6, 0,99.0,517.2,1,1,1,F,B01*7C\n" +
            "$THSJDRMSG,104831.000,30.621095717,N,104.065155268,E,471.81,2.29,157.57,6, 0,99.0,517.2,1,1,1,F,B01*72\n" +
            "$THSJDRMSG,104832.000,30.621078074,N,104.065167427,E,471.72,2.29,141.31,6, 0,99.0,517.1,1,1,1,F,B01*74\n" +
            "$THSJDRMSG,104833.000,30.621067822,N,104.065180779,E,471.76,1.72,124.33,6, 0,99.0,517.1,1,1,1,F,B01*79\n" +
            "$THSJDRMSG,104834.000,30.621060908,N,104.065196872,E,471.71,1.72,110.17,6, 0,99.0,517.1,1,1,1,F,B01*75\n" +
            "$THSJDRMSG,104835.000,30.621057272,N,104.065214276,E,471.66,1.72,98.86,6, 0,99.0,517.1,1,1,1,F,B01*4E\n" +
            "$THSJDRMSG,104836.000,30.621056378,N,104.065226197,E,471.67,1.14,92.45,6, 0,99.0,517.1,1,1,1,F,B01*4E\n" +
            "$THSJDRMSG,104837.000,30.621056378,N,104.065235138,E,471.67,0.86,88.28,6, 0,99.0,517.1,1,1,1,F,B01*42\n" +
            "$THSJDRMSG,104838.000,30.621056736,N,104.065241098,E,471.69,0.57,84.95,6, 0,99.0,517.1,1,1,1,F,B01*43\n" +
            "$THSJDRMSG,104839.000,30.621057272,N,104.065247059,E,471.70,0.57,84.05,6, 0,99.0,517.1,1,1,1,F,B01*4C\n" +
            "$THSJDRMSG,104840.000,30.621057749,N,104.065253019,E,471.69,0.57,85.28,6, 0,99.0,517.1,1,1,1,F,B01*48\n" +
            "$THSJDRMSG,104841.000,30.621057928,N,104.065256000,E,471.70,0.29,86.32,6, 0,99.0,517.1,1,1,1,F,B01*44\n" +
            "$THSJDRMSG,104842.000,30.621058047,N,104.065258980,E,471.69,0.29,86.66,6, 0,99.0,517.1,1,1,1,F,B01*4E\n" +
            "$THSJDRMSG,104843.000,30.621058226,N,104.065261960,E,471.68,0.29,86.75,6, 0,99.0,517.1,1,1,1,F,B01*4D\n" +
            "$THSJDRMSG,104853.000,30.621058345,N,104.065264940,E,471.69,0.29,86.43,6, 0,99.0,517.1,1,1,1,F,B01*4B\n" +
            "$THSJDRMSG,104854.000,30.621058881,N,104.065273881,E,471.70,0.86,85.49,6, 0,99.0,517.1,1,1,1,F,B01*41\n" +
            "$THSJDRMSG,104855.000,30.621060014,N,104.065288782,E,471.75,1.43,84.74,6, 0,99.0,517.2,1,1,1,F,B01*46\n" +
            "$THSJDRMSG,104856.000,30.621061981,N,104.065312624,E,471.72,2.29,84.58,6, 0,99.0,517.4,1,1,1,F,B01*4E\n" +
            "$THSJDRMSG,104857.000,30.621064782,N,104.065348387,E,471.52,3.43,84.83,6, 0,99.0,517.6,1,1,1,F,B01*4F\n" +
            "$THSJDRMSG,104858.000,30.621067762,N,104.065387130,E,471.59,3.72,85.15,6, 0,99.0,517.6,1,1,1,F,B01*47\n" +
            "$THSJDRMSG,104859.000,30.621070921,N,104.065431833,E,471.45,4.29,85.21,6, 0,99.0,517.8,1,1,1,F,B01*44\n" +
            "$THSJDRMSG,104900.000,30.621074617,N,104.065482497,E,471.09,4.86,85.23,6, 0,99.0,517.7,1,1,1,F,B01*4D\n" +
            "$THSJDRMSG,104901.000,30.621077657,N,104.065530300,E,471.01,4.58,86.89,6, 0,99.0,517.6,1,1,1,F,B01*43\n" +
            "$THSJDRMSG,104902.000,30.621076941,N,104.065572143,E,470.94,4.01,96.22,6, 0,99.0,517.5,1,1,1,F,B01*48\n" +
            "$THSJDRMSG,104903.000,30.621070445,N,104.065604091,E,470.95,3.15,110.20,6, 0,99.0,517.4,1,1,1,F,B01*75\n" +
            "$THSJDRMSG,104904.000,30.621060431,N,104.065624833,E,471.02,2.29,128.57,6, 0,99.0,517.3,1,1,1,F,B01*7F\n" +
            "$THSJDRMSG,104905.000,30.621045232,N,104.065640807,E,470.95,2.29,147.43,6, 0,99.0,517.3,1,1,1,F,B01*7A\n" +
            "$THSJDRMSG,104906.000,30.621028841,N,104.065649390,E,470.98,2.00,162.62,6, 0,99.0,517.3,1,1,1,F,B01*72\n";

    String[] strArr;

    private static float[] hei = {476.70f,476f,476f,476f,476f,476f,476f,469f,469f,469f,469f,469f,469f,469f,469f,469f,469f,455f,455f,455f,455f,455f,455f,455f,455f,469f,469f,469f,469f,469f,469f,469f,469f,469f,469f};
    private static double[] hei1 = {104.06187879199999,104.06187879199999,104.06187879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06587879199999,104.06187879199999,104.06187879199999,104.06187879199999};
    private static int m = 1;
    private Handler handler = new Handler(Looper.getMainLooper());

    BluetoothManager bluetoothManager = null;

    static BluetoothAdapter mBluetoothAdapter = null;

    StringBuffer stringBuilder = new StringBuffer();
    Dialog dialog;

    NavigationResultActivityShang basicUserLocation;
    private static BluetoothGatt mBluetoothGatt;
    private BluetoothGattService linkLossService;
    private static BluetoothGattCharacteristic alertLevel;
    ArrayList<Blue> blues = new ArrayList<>();
    BlueAdapter mBlueAdapter;
    private CoordinateConverter coord;
    private boolean isFirstBle = true;
    private boolean enter=false;
    private static int navigationBLe=0;
    private boolean tccok = true;
    private boolean trkok = false;
    private boolean tckok = false;
    private boolean zhkok = false;
    private String strTcc;
    private String strTrk;
    private String strTck;
    private String strZhk;
    private String strJzd;
    private String packName = "";
    private boolean clearData = false;
    private boolean sendEj = false;


    public BLELocationClient(final Context context, Global global, ListView bleList, Dialog dialog1, ProgressBar ble_pro, bleCallBack.bleCall bleCallback) {
        this.context = context;

        ApplicationData.isBreak = false;

        this.global = global;

        this.bleList = bleList;

        this.dialog = dialog1;

        this.ble_pro = ble_pro;

        this.bleCallback = bleCallback;
        navigationBLe=0;

        BluetoothManager bluetoothManager = (BluetoothManager) context.getSystemService(Context.BLUETOOTH_SERVICE);

        strArr = str.split("\\$");
        m=0;
//        m=strArr.length-1;

        blues.clear();

        mBluetoothAdapter = bluetoothManager.getAdapter();

        if (!mBluetoothAdapter.isEnabled()) {
            mBluetoothAdapter.enable();
            try {
                Thread.sleep(1500);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }

        mBluetoothAdapter.getBluetoothLeScanner().startScan(this);

        basicUserLocation = null;
        basicUserLocation = new NavigationResultActivityShang();

        bleList.setOnItemClickListener(new AdapterView.OnItemClickListener() {
            @Override
            public void onItemClick(AdapterView<?> parent, View view, int position, long id) {
                connectBle(blues.get(position).getNeme(),blues.get(position).getMac(),blues.get(position).getmBluetoothDevice());
            }
        });

        Thread thread=new Thread(this);
        thread.start();
    }

    public BLELocationClient(bleCallBack.bleCall callback) {
        ApplicationData.isBreak = false;
        this.bleCallback = null;
        this.NavigationBleCallback = callback;
        navigationBLe=1;
    }

    public void setBleCall(bleCallBack.bleCall call){
        ApplicationData.isBreak = false;
        this.NavigationBleCallback = null;
        this.bleCallback = call;
        navigationBLe=0;
    }
    public void setHomeCall(bleCallBack.bleCall call){
        this.HomeBleCallback = call;
    }
    public void clearCall(){
        this.bleCallback = null;
    }

    public void clearNavigation(){
        this.NavigationBleCallback = null;
    }

    public void clearCallAll(){
        this.bleCallback = null;
        this.NavigationBleCallback = null;
    }

    public void connectBle(String name, String address, BluetoothDevice device){

//                blues.get(position).getmBluetoothDevice();
        dialog.dismiss();
        isFirstBle = true;
        ShowBar.dismissProgress(context);
        ShowBar.showProgress("蓝牙连接中...",context,true);
        if (mBluetoothGatt!=null && mBluetoothGatt.connect()){
            mBluetoothGatt.disconnect();
            alertLevel=null;
        }
        mBluetoothAdapter.getBluetoothLeScanner().stopScan(BLELocationClient.this);
//                Log.d("蓝牙MAC",blues.get(position).getmBluetoothDevice().getAddress());
        mBluetoothGatt = device.connectGatt(context, true, new BluetoothGattCallback() {
            @Override
            public void onPhyUpdate(BluetoothGatt gatt, int txPhy, int rxPhy, int status) {
                super.onPhyUpdate(gatt, txPhy, rxPhy, status);
            }

            @Override
            public void onPhyRead(BluetoothGatt gatt, int txPhy, int rxPhy, int status) {
                super.onPhyRead(gatt, txPhy, rxPhy, status);
            }

            @Override
            public void onConnectionStateChange(BluetoothGatt gatt, int status, int newState) {
                if (newState == BluetoothProfile.STATE_CONNECTED) {
                    ShowBar.dismissProgress(context);
                    gatt.discoverServices();
                    ApplicationData.bleConnect = true;
                    if (HomeBleCallback!=null) {
                        HomeBleCallback.bleConnectSuccess();
                    }
                    if (NavigationBleCallback!=null){
                        NavigationBleCallback.bleConnectSuccess();
                    }
                    if (bleCallback!=null){
                        bleCallback.bleConnectSuccess();
                    }
                    /*if (bleCallback!=null){
                        bleCallback.bleConnectSuccess();
                    }else if (NavigationBleCallback!=null){
                        NavigationBleCallback.bleConnectSuccess();
                    }*/
                    handler.post(()->{
                        Toast.makeText(getApplicationContext(),"蓝牙连接成功",Toast.LENGTH_SHORT).show();
                    });
                } else if (newState == BluetoothProfile.STATE_DISCONNECTED) {
                    gatt.close();
                    ApplicationData.bleConnect = false;
                    ApplicationData.alterLevelOk=false;
                    ApplicationData.Exit_tcc=true;
                    /*HomeBleCallback.bleConnectFailed();
                    if (bleCallback!=null){
                        bleCallback.bleConnectFailed();
                    }else if (NavigationBleCallback!=null){
                        NavigationBleCallback.bleConnectFailed();
                    }*/
                    ApplicationData.Exit_tcc = true;
                    sendEj = false;
                    handler.post(()->{
                        Toast.makeText(getApplicationContext(),"连接已断开",Toast.LENGTH_SHORT).show();
                    });
                }
                return;
            }
            //发现服务，在蓝牙连接的时候会调用
            @Override
            public void onServicesDiscovered(BluetoothGatt gatt, int status) {

                List<BluetoothGattService> list = mBluetoothGatt.getServices();
                for (BluetoothGattService bluetoothGattService:list){
                    String str = bluetoothGattService.getUuid().toString();
//                        Log.e("onServicesDisc中中中", " ：" + str);
                    List<BluetoothGattCharacteristic> gattCharacteristics = bluetoothGattService
                            .getCharacteristics();
                    for (BluetoothGattCharacteristic gattCharacteristic : gattCharacteristics) {
                        Log.e("onServicesDisc中中中", " ：" + gattCharacteristic.getUuid());
                        if(CHARACTER_UUID.equals(gattCharacteristic.getUuid().toString())){
                            linkLossService=bluetoothGattService;
                            alertLevel=gattCharacteristic;
                            ApplicationData.alterLevelOk=true;
                            ShowBar.dismissProgress(context);
                            Log.e("daole",alertLevel.getUuid().toString());
                        }
                    }
                }
                enableNotification(true,gatt,alertLevel);
                /*BluetoothGattCharacteristic chara = gatt.getService(UUID.fromString(SERVICE_UUID))
                        .getCharacteristic(UUID.fromString(CHARACTER_UUID));
                gatt.setCharacteristicNotification(chara, true);*/
            }

            @Override
            public void onCharacteristicRead(BluetoothGatt gatt, BluetoothGattCharacteristic characteristic, int status) {
                super.onCharacteristicRead(gatt, characteristic, status);
            }
            /**
             *  发送数据后的回调
             * @param gatt
             * @param characteristic
             * @param status
             */
            //接受Characteristic被写的通知,收到蓝牙模块的数据后会触发onCharacteristicWrite
            @Override
            public void onCharacteristicWrite(BluetoothGatt gatt, BluetoothGattCharacteristic characteristic, int status) {
                if(status == BluetoothGatt.GATT_SUCCESS){//写入成功
                    Log.e("onCharacteristicWrite中", "写入成功");
                    Toast.makeText(context,"发送成功",Toast.LENGTH_SHORT).show();
                }else if (status == BluetoothGatt.GATT_FAILURE){
                    Log.e("onCharacteristicWrite中", "写入失败");
                }else if (status == BluetoothGatt.GATT_WRITE_NOT_PERMITTED){
                    Log.e("onCharacteristicWrite中", "没权限");
                }

            }

            // Characteristic 改变，数据接收会调用

            @Override
            public void onCharacteristicChanged(BluetoothGatt gatt, BluetoothGattCharacteristic characteristic) {
                String arrayOfByte = characteristic.getStringValue(0);

                stringBuilder.append(arrayOfByte);
            }

            @Override
            public void onDescriptorRead(BluetoothGatt gatt, BluetoothGattDescriptor descriptor, int status) {
                super.onDescriptorRead(gatt, descriptor, status);
            }

            @Override
            public void onDescriptorWrite(BluetoothGatt gatt, BluetoothGattDescriptor descriptor, int status) {
                super.onDescriptorWrite(gatt, descriptor, status);
            }

            @Override
            public void onReliableWriteCompleted(BluetoothGatt gatt, int status) {
                super.onReliableWriteCompleted(gatt, status);
            }

            @Override
            public void onReadRemoteRssi(BluetoothGatt gatt, int rssi, int status) {
                super.onReadRemoteRssi(gatt, rssi, status);
            }

            @Override
            public void onMtuChanged(BluetoothGatt gatt, int mtu, int status) {
                Log.d("BLE","onMtuChanged mtu="+mtu+",status="+status);
                super.onMtuChanged(gatt, mtu, status);
            }
        });
    }

    public void closeBLE(){
        if (mBluetoothAdapter.isEnabled()) {
            mBluetoothAdapter.disable();
        }
        mBluetoothAdapter = null;
    }


    @Override
    public void onScanFailed(int errorCode) {
        super.onScanFailed(errorCode);
        Toast.makeText(context, "扫描失败", Toast.LENGTH_SHORT).show();
        if (mBluetoothAdapter.isEnabled())
            mBluetoothAdapter.disable();
    }

    @Override
    public void onScanResult(int callbackType, ScanResult result) {
        super.onScanResult(callbackType, result);
        Blue mBlue = new Blue();
        String devName = result.getDevice().getName();
        mBlue.setNeme(result.getDevice().getName());
        mBlue.setMac(result.getDevice().getAddress());
        mBlue.setmBluetoothDevice(result.getDevice());

        if (result.getDevice().getName()!=null) {
            if (result.getDevice().getName().equals("THSJ-H4.01")) {
                connectBle(result.getDevice().getName(), result.getDevice().getAddress(), result.getDevice());
            }
        }
        if (blues!=null)
        if (blues.size()==0){
            blues.add(mBlue);
            ble_pro.setVisibility(View.GONE);
        }
        int flag=0;
        if (blues!=null && blues.size()>0) {
            for (int i = 0; i < blues.size(); i++) {
                if (blues.get(i)!=null)
                if (!TextUtils.isEmpty(blues.get(i).getMac()) && !TextUtils.isEmpty(result.getDevice().getAddress())) {
                    if (blues.get(i).getMac().equals(result.getDevice().getAddress()))
                        flag = 1;
                }
            }
        }
        if (flag==0){
            blues.add(mBlue);
        }
        if (isFirstBle) {
            isFirstBle = false;
            mBlueAdapter = new BlueAdapter(context, blues);
            bleList.setAdapter(mBlueAdapter);
        }else {
            mBlueAdapter.notifyDataSetChanged();
        }
    }

    public boolean setMTU(int mtu){
        Log.d("BLE","setMTU "+mtu);

        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP){
            if(mtu>20){
                boolean ret =   mBluetoothGatt.requestMtu(mtu);
                Log.d("BLE","requestMTU "+mtu+" ret="+ret);
                return ret;
            }
        }

        return false;
    }
    private void enableNotification(boolean enable, BluetoothGatt gatt, BluetoothGattCharacteristic characteristic) {
        if (gatt == null || characteristic == null) {
            ApplicationData.bleConnect = false;
            if (gatt.connect()){
                gatt.disconnect();
            }
            handler.post(()->{
                Toast.makeText(getApplicationContext(),"连接已断开",Toast.LENGTH_SHORT).show();
            });
            return; //这一步必须要有 否则收不到通知
        }else {
            boolean b = gatt.setCharacteristicNotification(characteristic, enable);
            Log.d("blueAl = ",b+"");
            if (b){
                for (BluetoothGattDescriptor dp:characteristic.getDescriptors()){
                    if (dp!=null){
                        if ((characteristic.getProperties() & BluetoothGattCharacteristic.PROPERTY_NOTIFY) != 0){
                            dp.setValue(BluetoothGattDescriptor.ENABLE_NOTIFICATION_VALUE);
                        }else if ((characteristic.getProperties() & BluetoothGattCharacteristic.PROPERTY_INDICATE)!=0){
                            dp.setValue(BluetoothGattDescriptor.ENABLE_INDICATION_VALUE);
                        }
                        gatt.writeDescriptor(dp);
                    }
                }
            }
        }
    }

    /**
     * 向蓝牙发送数据
     */
    public void dataSend(String str){
        //byte[] send={(byte) 0xaa,0x01,0x01,(byte)0x81,(byte) 0xff};
        /*byte[] send = new byte[20];
        send = hexStringToBytes(str);
        byte[] sendData=new byte[send.length+2];
        sendData[0]=(byte) 0xaa;
        sendData[sendData.length-1]=(byte) 0xff;
        for(int i=1;i<sendData.length-1;i++){
            sendData[i]=send[i-1];
        }
        Log.e("dataSend", bytesToHexString(sendData));
        Log.e("dataSend", linkLossService +"");*/
//        setMTU(85);
        byte[] bytes = str.getBytes();

        int d = (int) Math.ceil((bytes.length)/(double)20);

        if (alertLevel!=null) {
            for (int i = 0; i < d; i++) {
                if (i == d - 1) {
                    byte[] bytes1 = new byte[bytes.length - 20 * i];
                    System.arraycopy(bytes, i * 20, bytes1, 0, bytes.length - 20 * i);
                    alertLevel.setValue(bytes1);
                    mBluetoothGatt.writeCharacteristic(alertLevel);
                } else {
                    byte[] bytes1 = new byte[20];
                    System.arraycopy(bytes, i * 20, bytes1, 0, 20);
                    alertLevel.setValue(bytes1);
                    mBluetoothGatt.writeCharacteristic(alertLevel);
                }
                try {
                    Thread.sleep(10);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }else {
            if (mBluetoothGatt!=null){
                if (mBluetoothGatt.connect()){
                    mBluetoothGatt.disconnect();
                }
            }
            handler.post(()->{
                Toast.makeText(getApplicationContext(),"蓝牙连接错误！",Toast.LENGTH_SHORT).show();
            });
        }
    }

    public static final String bytesToHexString(byte[] bArray) {
        StringBuffer sb = new StringBuffer(bArray.length);
        String sTemp;
        for (int i = 0; i < bArray.length; i++) {
            sTemp = Integer.toHexString(0xFF & bArray[i]);
            if (sTemp.length() < 2)
                sb.append(0);
            sb.append(sTemp.toUpperCase());
        }
        return sb.toString();
    }

    public static byte[] hexStringToBytes(String hex) {
        int len = (hex.length() / 2);
        byte[] result = new byte[len];
        char[] achar = hex.toCharArray();
        for (int i = 0; i < len; i++) {
            int pos = i * 2;
            result[i] = (byte) (toByte(achar[pos]) << 4 | toByte(achar[pos + 1]));
        }
        return result;
    }
    private static byte toByte(char c) {
        byte b = (byte) "0123456789ABCDEF".indexOf(c);
        return b;
    }


    //数据处理
    @Override
    public void run() {
        while (true) {

            try {
                Thread.sleep(1200);
                String message = stringBuilder.toString();
                String showMessage = message;
                Log.d("接收到的数据:", message);
                /*if (TextUtils.isEmpty(message)){
                    return;
                }*/
                if(ApplicationData.monidaohang) {
                    if (m >= strArr.length) {
                        m = 1;
                    }
                    /*if (m<=0){
                        m = strArr.length-1;
                    }*/
                    ApplicationData.bleConnect = true;
                    message = strArr[m];
                    m++;
//                    m--;
                }
                if (message.contains("EXIT_")){
                    ApplicationData.Exit_tcc=true;
                    ApplicationData.Exit_tccdata=true;
                    tccok = false;
                    tckok = false;
                    trkok = false;
                    zhkok = false;
                    handler.post(()->{
                        Toast.makeText(getApplicationContext(),"退出室内地图",Toast.LENGTH_SHORT).show();
                    });
                }
                if (ApplicationData.alterLevelOk && ApplicationData.Exit_tcc && !tccok){
                    ShowBar.dismissProgress(context);
                    dataSend(strTcc);
                    tccok = true;
                }
                if (message.contains("TCC")){
                    handler.post(()->{
                        if (clearData){
                            clearData = false;
                            Toast.makeText(getApplicationContext(),packName+"停车场信息清除成功",Toast.LENGTH_SHORT).show();
                        }else if (ApplicationData.alterLevelOk && ApplicationData.Exit_tcc && !trkok){
                            Toast.makeText(getApplicationContext(),packName+"停车场信息发送成功",Toast.LENGTH_SHORT).show();
                            dataSend(strTrk);
                            trkok = true;
                        }
                    });
                }
                if (message.contains("TRK")){
                    handler.post(()->{
                        if (ApplicationData.alterLevelOk && ApplicationData.Exit_tcc && !tckok){
                            Toast.makeText(getApplicationContext(),packName+"入口信息发送成功",Toast.LENGTH_SHORT).show();
                            dataSend(strTck);
                            tckok = true;
                        }
                    });
                }
                if (message.contains("TCK")){
                    handler.post(()->{
                        if (ApplicationData.alterLevelOk && ApplicationData.Exit_tcc && !zhkok){
                            Toast.makeText(getApplicationContext(),packName+"出口信息发送成功",Toast.LENGTH_SHORT).show();
                            dataSend(strZhk);
                            zhkok = true;
                        }
                    });
                }
                if (message.contains("ZHK")){
                    handler.post(()->{
                        if (ApplicationData.alterLevelOk && ApplicationData.Exit_tcc){
                            Toast.makeText(getApplicationContext(),packName+"转换口信息发送成功",Toast.LENGTH_SHORT).show();
                            if (!sendEj) {
                                dataSend(strJzd);
                            }
                            ApplicationData.Exit_tcc = false;
                        }
                    });
                }
                if (message.contains("JZD")){
                    if (message.contains("JZD_TCC")){
                        handler.post(()->{
                            Toast.makeText(getApplicationContext(),packName+"校准成功",Toast.LENGTH_SHORT).show();
                        });
                    }else {
                        handler.post(() -> {
                            if (ApplicationData.alterLevelOk && !sendEj) {
                                Toast.makeText(getApplicationContext(), packName + "校准点信息发送成功", Toast.LENGTH_SHORT).show();
                            }
                        });
                    }
                }
                if (message.contains("ENTER_")){
                    ApplicationData.enter=true;
                    handler.post(()->{
                        Toast.makeText(getApplicationContext(),packName+"进入室内地图",Toast.LENGTH_SHORT).show();
                    });
                }
                if(ApplicationData.monidaohang) {

                }else {
                    message = message.substring(message.indexOf("$THSJDRMSG,"));
                }
                if (!TextUtils.isEmpty(message)) {
                    if (message.length() > 80 && message.indexOf("E") > 40 && (message.length() > (message.indexOf("E") + 9))) {
                        String[] mesArr = message.split(",");
                        String length = "";
                        String speed = "";
                        String[] result = str.split(",");

                        if (result.length > 2) {
                            Log.d("接收到的数据:", "纬度：" + result[0] + "\n 经度:" + result[2] + "\n时间：" + mesArr[1] + "\n高度："+mesArr[12]);
                            Message msg = Message.obtain();
                            Bundle bundle = new Bundle();
                            /*bundle.putString("lat", result[0]);
                            bundle.putString("lon", result[2]); */
                            if(mesArr!=null && mesArr.length>=12){
                                Random random=new Random();// 定义随机类
                                Double lat = Double.valueOf(mesArr[2]);
                                Double lon = Double.valueOf(mesArr[4]);
                                String bering = mesArr[8];
                                Float ber;
                                if (TextUtils.isEmpty(bering)){
                                    ber = 0f;
                                }else {
                                    ber = Float.parseFloat(bering);
                                }
                                length = mesArr[12];
                                speed = mesArr[7];
                                bundle.putString("lat", String.valueOf(lat));
                                bundle.putString("lon", String.valueOf(lon));
                                bundle.putString("hei", length);
                                bundle.putString("time", mesArr[1]);
                                bundle.putString("speed", speed);
                                bundle.putFloat("bearing",ber);
                                bundle.putString("floor",mesArr[17]);
                                bundle.putString("message",message);
                                bundle.putBoolean("isenter",ApplicationData.enter);
                           /* m = m+1;
                            if (m>hei.length){
                                m=0;
                            }
                            bundle.putString("hei", String.valueOf(hei[m]));*/
                               /* msg.what = 1;
                                msg.setData(bundle);
                                basicUserLocation.handler.sendMessage(msg);*/

//                                if (ApplicationData.guide_choose==1) {
                                if (HomeBleCallback!=null) {
                                    HomeBleCallback.bleCallSuccess(bundle);//定位成功 post发送给需要定位结果的页面
                                }
                                    if (navigationBLe==1) {
                                        if (navigationBLe==1) {
                                            if (NavigationBleCallback != null) {
                                                NavigationBleCallback.bleCallSuccess(bundle);//定位成功 post发送给需要定位结果的页面
                                            }
                                        }
                                    }else {
                                        if (navigationBLe==0) {
                                            if (bleCallback != null) {
                                                bleCallback.bleCallSuccess(bundle);//定位成功 post发送给需要定位结果的页面
                                            }
                                        }
                                    }
//                                }
                            }
                        }
                    }
//                    stringBuilder.delete(0, stringBuilder.length());
                }else {
//                    if (ApplicationData.guide_choose==1) {
//                        if (ApplicationData.guide_choose==1) {
                            if (navigationBLe==1) {
                                if (NavigationBleCallback!=null){
                                    NavigationBleCallback.bleCallFailed(new Bundle());//定位成功 post发送给需要定位结果的页面
                                }
                            }else {
                                if (bleCallback != null) {
                                    bleCallback.bleCallFailed(new Bundle());//定位成功 post发送给需要定位结果的页面
                                }
                            }
//                        }
//                    }
                }
                stringBuilder.delete(0, stringBuilder.length());
            } catch (Exception e) {
                e.printStackTrace();
//                if (ApplicationData.guide_choose==1) {
                    if (navigationBLe==1) {
                        if (NavigationBleCallback!=null){
                            NavigationBleCallback.bleCallFailed(new Bundle());//定位成功 post发送给需要定位结果的页面
                        }
                    }else {
                        if (bleCallback != null) {
                            bleCallback.bleCallFailed(new Bundle());//定位成功 post发送给需要定位结果的页面
                        }
                    }
//                }
                stringBuilder.delete(0, stringBuilder.length());
            }
        }
    }

    public void closeBle(){
        ApplicationData.isBreak = true;
        if (mBluetoothGatt!=null && mBluetoothGatt.connect()){
            mBluetoothGatt.disconnect();
            alertLevel=null;
        }
    }

    public void resetdata(String name){
        packName = name;
        for (int i=0;i<dataMsgs.length;i++){
            if (name.contains(dataMsgs[i][0])){
                strTcc = dataMsgs[i][1];
                strTrk = dataMsgs[i][2];
                strTck = dataMsgs[i][3];
                strZhk = dataMsgs[i][4];
                strJzd = dataMsgs[i][5];
                ApplicationData.Exit_tcc=true;
                ApplicationData.isBreak = false;
                tccok = false;
                tckok = false;
                trkok = false;
                zhkok = false;
                break;
            }
        }
        if (tccok){
            handler.post(()->{
                    Toast.makeText(getApplicationContext(),"停车场信息发送失败，请选择正确的停车场",Toast.LENGTH_SHORT).show();
                });
        }
    }

    public void sendData(String name){
        sendEj = false;
        resetdata(name);
    }

    public void sendJzdData(String name){
        sendEj = false;
        packName = name;
        for (int i=0;i<dataMsgs.length;i++){
            if (name.contains(dataMsgs[i][0])){
                strTcc = dataMsgs[i][1];
                strTrk = dataMsgs[i][2];
                strTck = dataMsgs[i][3];
                strZhk = dataMsgs[i][4];
                strJzd = dataMsgs[i][5];
                break;
            }
        }
        dataSend(strJzd);
    }
    public void sendDataEJ(String name){
        sendEj = true;
        resetdata(name);
    }

    public void clearData(String name){
        clearData = true;
        for (int i=0;i<dataMsgs.length;i++){
            if (name.contains(dataMsgs[i][0])){
                strTcc = dataMsgs[i][1];
                strTrk = dataMsgs[i][2];
                strTck = dataMsgs[i][3];
                strZhk = dataMsgs[i][4];
                strJzd = dataMsgs[i][5];
                break;
            }
        }
        if (!TextUtils.isEmpty(strTcc)) {
            dataSend(strTcc);
        }
    }

}
